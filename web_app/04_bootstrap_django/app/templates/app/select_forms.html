{% extends "base.html" %}

{% block main %}
<div class ="welcome">
  <h1 class="title">Select Forms</h1>
  
  <h2>選択項目一覧</h2>
  
  <p><a class="btn btn-primary" href="{% url 'select_forms_add_item' %}">選択項目を追加</a></p>
  
  <p>
  {% if select_items %}
    <ul class="list-group">
    {% for select_item in select_items %}
      <li class="list-group-item">{{ select_item }}</li>
    {% endfor %}
    </ul>
  {% else %}
    No Items
  {% endif %}
  </p>
  
  {% if select_items %}
    <h2>チェックボックス</h2>
    <form method="post">
    {% csrf_token %}
      <p>
      <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
      {% for select_item in select_items %}
        <input type="checkbox" class="btn-check" name="checkbox" id="checkbox {{ select_item.item_name }}" value="{{ select_item.item_name }}" autocomplete="off" {{ select_item.check_status }}>
        <label class="btn btn-outline-primary" for="checkbox {{ select_item.item_name }}">{{ select_item.item_name }}</label>
      {% endfor %}
      </div>
      </p>
      <p><button class="btn btn-primary" type="submit" name="save_check_status">チェックボックスの状態を保存</button></p>
    </form>
    
    <h2>ラジオボタン</h2>
    <form method="post">
    {% csrf_token %}
      <p>
      <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
      {% for select_item in select_items %}
        <input type="radio" class="btn-check" name="radiobox" id="radiobox {{ select_item.item_name }}" value="{{ select_item.item_name }}" autocomplete="off" {{ select_item.radio_status }}>
        <label class="btn btn-outline-primary" for="radiobox {{ select_item.item_name }}">{{ select_item.item_name }}</label>
      {% endfor %}
      </div>
      </p>
      <p><button class="btn btn-primary" type="submit" name="save_radio_status">ラジオボタンの状態を保存</button></p>
    </form>
    
    <h2>ドロップダウン</h2>
    <form method="post">
    {% csrf_token %}
      <div class="btn-group">
        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
          {{ dropdown_text }}
        </button>
        <ul class="dropdown-menu">
        {% for select_item in select_items %}
          <li><button class="dropdown-item" type="submit" name="dropdown" value="{{ select_item.item_name }}">{{ select_item.item_name }}</button></li>
        {% endfor %}
        </ul>
      </div>
    </form>
    
    <h2>ドロップダウン（Submitボタン押下で反映）</h2>
    <div class="dropdown">
      <button class="btn btn-primary dropdown-toggle" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
        {{ dropdown_text_with_submit }}
      </button>
      <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" id="dropdownMenuButton1_list">
        {% for select_item in select_items %}
          <li><button class="dropdown-item" value="{{ select_item.item_name }}">{{ select_item.item_name }}</li>
        {% endfor %}
      </ul>
      <script>
        // id=dropdownMenuButton1_listのdropdown-menu内のliタグに対してリスナにクリックイベントを追加する
        dropdown_list = document.querySelector('#dropdownMenuButton1_list')
        dropdown_list.querySelectorAll('li').forEach( function(el) {
          el.addEventListener('click', function() {
            // console.log('Click dropdown item');
            // console.log(el.textContent);
            
            display = document.getElementById('dropdownMenuButton1');
            display.innerText = el.textContent;
            
            ele = document.getElementById('dropdownMenuButton1_submit')
            ele.value = el.textContent;
          });
        });
      </script>
    </div>
    <form method="post">
    {% csrf_token %}
      <!--
        buttonタグをformタグで囲むとドロップダウン押下時にPOSTされてしまうので，
        form外にbuttonを作成して，Javascriptでform内のhidden型のvalueを設定する
      -->
      <input type="hidden" name="dropdownMenuButton1_submit" id="dropdownMenuButton1_submit" value="">
      <p><button class="btn btn-primary" type="submit" name="save_dropdown_item" id="save_dropdown_item">ドロップダウンの状態を保存</button></p>
    </form>
  
  {% endif %}
</div>
{% endblock %}
